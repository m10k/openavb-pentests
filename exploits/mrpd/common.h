/*
 * This file is part of openavb-pentests
 * Copyright (C) 2016 Matthias Kruk
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along
 * with this program; if not, write to the Free Software Foundation, Inc.,
 * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA. 
 */

#ifndef _COMMON_H
#define _COMMON_H

#define PROTO_MVRP 0x88F5
#define PROTO_MMRP 0x88F6
#define PROTO_MSRP 0x22EA
#define PROTO_MIRP 0x8929

#define MMRP_VER   0
#define MVRP_VER   0

#define MMRP_SVCREQ_TYPE 1
#define MMRP_MACVEC_TYPE 2
#define MVRP_VID_TYPE    1

#include <stdlib.h>
#include <stdint.h>

typedef struct mrp mrp_t;
typedef struct mrp_msg mrp_msg_t;
typedef struct mrp_socket mrp_socket_t;

typedef struct mrpdu_message {
    uint8_t type;
    uint8_t len;
    uint8_t data[0];
} mrpdu_message_t;

typedef struct mrpdu {
    uint8_t ver;
    mrpdu_message_t msg[];
} mrpdu_t;

struct mrp_socket* mrp_socket_open(uint16_t, const char*);
int mrp_socket_send(struct mrp_socket*, const void*, const size_t);
int mrp_socket_close(struct mrp_socket*);

mrp_t* mrp_new(uint8_t);
void mrp_free(mrp_t*);
int mrp_append(mrp_t*, mrp_msg_t*);

mrp_msg_t* mrp_msg_new(uint8_t, uint8_t);
int mrp_msg_append(mrp_msg_t*, void*, size_t);

ssize_t mrp_raw(mrp_t*, void*, size_t);

#endif /* _COMMON_H */
